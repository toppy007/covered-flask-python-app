{% extends "base.html" %}

{% block title %}Generate{% endblock %}

{% block content %}
<br />
<h3 align="center">Create Job Optimised Resume</h3>
<br />

<form action="{{ url_for('views.generate') }}" method="post">
  <div class="form-group">
    <label for="job_ad">Paste Job Advertisement</label>
    <textarea
      class="form-control"
      id="job_ad"
      name="job_ad"
      rows="8"
      placeholder="Enter job advertisement content"
    ></textarea>
  </div>

  <h5 align="left">Add core skill to the personal statement</h5>
    <div class="form-group">
        <label for="selectTag">Select a Skill:</label>
        <select id="selectTag" class="form-control">
            {% for note in user.notes %}
            <option value="{{ note.data }}">{{ note.data }}</option>
            {% endfor %}
        </select>
    </div>
    <div>
        <input type="hidden" name="selectedSkills" id="selectedSkillsInput">
        <button type="button" class="btn btn-primary" onclick="addSelectedSkill()">Add Skill Tag</button>
  </div>

  <div class="mt-3">
    <div id="selectedTags">
        <!-- Selected skill tags will be displayed here -->
    </div>
  </div>
  <br />

  <h5>Selected Word Count for the Personal Statement:</h5>

    <div class="form-group">
        <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault1">
            <label class="form-check-label" for="flexRadioDefault1">
                0 - 50
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault2" checked>
            <label class="form-check-label" for="flexRadioDefault2">
                51 - 100
            </label>
        </div>
        <!-- Add more radio buttons for other word count ranges -->
        <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault3">
            <label class="form-check-label" for="flexRadioDefault3">
                101 - 150
            </label>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="flexRadioDefault" id="flexRadioDefault4">
            <label class="form-check-label" for="flexRadioDefault4">
                151 - 200
            </label>
        </div>
        <!-- Add more radio buttons for additional word count ranges -->
    </div>

    <div>
        <button type="submit" class="btn btn-primary" onclick="printSelection()">Create</button>
    </div>
</form>

<div class="mt-3">
    <h5>Selected Inputs:</h5>
    <div id="selectedInputs">
        <!-- Selected inputs will be displayed here -->
    </div>
</div>

<h3>API Response:</h3>
<div>
    {% if api_response %}
        <p>{{ api_response | safe }}</p>
    {% else %}
        <p>No API response available.</p>
    {% endif %}
</div>

<script>
    function addSelectedSkill() {
        const selectTag = document.getElementById("selectTag");
        const selectedSkills = selectTag.value;

        const selectedSkillsInput = document.getElementById("selectedSkillsInput");
        selectedSkillsInput.value += selectedSkills + ",";  // Use comma or any separator you prefer

        // Remove the selected skill from the dropdown options
        selectTag.querySelector(`option[value="${selectedSkills}"]`).remove();

        // Display the selected skill tag in the separate area
        const selectedTagsDiv = document.getElementById("selectedTags");
        
        const tagContainer = document.createElement("div");
        tagContainer.className = "badge badge-secondary mr-1";
        
        const tagText = document.createElement("span");
        tagText.textContent = selectedSkills;
        tagContainer.appendChild(tagText);

        const deleteButton = document.createElement("span");
        deleteButton.innerHTML = "&times;";
        deleteButton.className = "ml-2";
        deleteButton.style.cursor = "pointer";
        deleteButton.onclick = function() {
            selectedTagsDiv.removeChild(tagContainer);
            // Optionally, add the skill back to the dropdown options
            selectTag.innerHTML += `<option value="${selectedSkills}">${selectedSkills}</option>`;
            $(skillInput).tagsinput('remove', selectedSkills);
        };
        
        tagContainer.appendChild(deleteButton);
        selectedTagsDiv.appendChild(tagContainer);
    }

</script>
{% endblock %}